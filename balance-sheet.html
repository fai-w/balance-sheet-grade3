<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>‡πÄ‡∏Å‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Comic Sans MS', sans-serif;
            background-color: #f0f8ff;
            text-align: center;
            margin: 0;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
            box-sizing: border-box;
        }

        h1 {
            color: #ff7f50;
        }

        select,
        button,
        input {
            font-size: 16px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #aaa;
            margin: 5px;
            max-width: 100%;
            box-sizing: border-box;
        }

        button {
            background-color: #ff7f50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .table-container {
            width: 100%;
            overflow-x: auto; /* Scroll horizontally if needed */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        #balanceTable th {
            text-align: center;
        }

        th,
        td {
            border: 2px solid #87ceeb;
            padding: 8px;
            text-align: right;
        }

        th:first-child,
        td:first-child {
            text-align: left;
        }

        th {
            background-color: #87ceeb;
            color: white;
        }

        .card {
            background-color: #ffebcd;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }

        input[type="number"] {
            width: 100%;
            max-width: 80px;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üç¨ ‡∏£‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Å‡∏ß‡∏≤‡∏î üç¨</h1>
        <div id="setup">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô:</label>
            <select id="childName">
                <option>‡πÄ‡∏°‡∏¢‡πå</option>
                <option>‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß</option>
                <option>‡∏ß‡∏¥‡∏ô</option>
                <option>‡πÅ‡∏ï‡∏á‡πÇ‡∏°</option>
            </select>
            <br>
            <label><input type="checkbox" id="includeSatang"> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°‡∏ö‡∏≤‡∏ó (‡∏£‡∏ß‡∏°‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå)</label>
            <br>
            <button onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        </div>

        <div id="game" class="hidden">
            <h2 id="balanceReveal"></h2>
            <button id="drawCardBtn" onclick="startAccounting()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ üìí</button>

            <div id="cardArea"></div>

            <div id="balanceTableArea"></div>

            <button id="submitBtn" onclick="submitEntry()" class="hidden" disabled>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
            <div id="feedback"></div>
        </div>
    </div>

    <script>
        let currentBalance, includeSatang, currentAmount, currentEvent;
        let eventTypes = [];

        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("setup").classList.remove("hidden");
        });

        function randomInitialBalance() {
            return 20 * (Math.floor(Math.random() * (80 - 60 + 1)) + 60);
        }

        function formatAmount(amount) {
            return includeSatang ? amount.toFixed(2) : amount;
        }

        function startGame() {
            const child = document.getElementById("childName").value;
            includeSatang = document.getElementById("includeSatang").checked;
            currentBalance = randomInitialBalance();

            eventTypes = [
                { event: child + "‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏Ç‡∏≤‡∏¢", type: "expense" },
                { event: child + "‡∏Ç‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏≠‡∏°‡πÑ‡∏î‡πâ", type: "income" },
                { event: child + "‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢", type: "income" },
                { event: child + "‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏Ç‡∏≤‡∏¢", type: "expense" }
            ];

            document.getElementById("balanceReveal").textContent = child + "‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏°‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô " + formatAmount(currentBalance) + " ‡∏ö‡∏≤‡∏ó! ü•≥";
            document.getElementById("setup").classList.add("hidden");
            document.getElementById("game").classList.remove("hidden");

        }

        function startAccounting() {
            drawTable(); // Now the table appears here
            const child = document.getElementById("childName").value;
            addToTable(child + "‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏°‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô", currentBalance, true);

            document.getElementById("balanceReveal").textContent = "";

            // Change button behavior to draw card
            const drawBtn = document.getElementById("drawCardBtn");
            drawBtn.textContent = "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå üé¥";
            drawBtn.onclick = drawCard;
            drawBtn.disabled = false;
        }

        function drawTable() {
            const tableArea = document.getElementById("balanceTableArea");
            tableArea.innerHTML = `
            <div class="table-container">
                <table id="balanceTable">
                    <tr>
                        <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                        <th>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡∏ö‡∏≤‡∏ó)</th>
                        <th>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th>
                        <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)</th>
                    </tr>
                </table>
            </div>
        `;
        }

        function drawCard() {
            document.getElementById("feedback").textContent = "";

            const randomEvent = eventTypes[Math.floor(Math.random() * eventTypes.length)];
            currentEvent = randomEvent.event;
            currentEventType = randomEvent.type; // use this to clearly track income or expense

            currentAmount = Math.floor(Math.random() * (currentBalance / 2)) + 20;
            if (includeSatang) currentAmount += Math.round(Math.random() * 99) / 100;

            const cardDiv = document.createElement("div");
            cardDiv.className = "card";
            cardDiv.textContent = currentEvent + " ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô " + formatAmount(currentAmount) + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById("cardArea").innerHTML = "";
            document.getElementById("cardArea").appendChild(cardDiv);

            addToTable(currentEvent, currentAmount, false);
            document.getElementById("drawCardBtn").disabled = true;
            document.getElementById("submitBtn").classList.remove("hidden");
        }

        function addToTable(event, amount, isInitial) {
            const table = document.getElementById("balanceTable");
            const newRow = table.insertRow();
            newRow.insertCell().textContent = event;

            if (isInitial) {
                newRow.insertCell().textContent = formatAmount(amount);
                newRow.insertCell().textContent = '';
                newRow.insertCell().textContent = formatAmount(amount);
            } else {
                const step = includeSatang ? '0.01' : '1';
                const pattern = includeSatang ? '^[0-9]+(\\.[0-9]{1,2})?$' : '\\d+';

                newRow.insertCell().innerHTML = `<input type="number" step="${step}" min="0" pattern="${pattern}" onchange="enableSubmit()">`;
                newRow.insertCell().innerHTML = `<input type="number" step="${step}" min="0" pattern="${pattern}" onchange="enableSubmit()">`;
                newRow.insertCell().innerHTML = `<input type="number" step="${step}" min="0" pattern="${pattern}" onchange="enableSubmit()">`;
            }
        }

        function enableSubmit() {
            document.getElementById("submitBtn").disabled = false;
            document.getElementById("feedback").textContent = "";
        }

        function submitEntry() {
            const inputs = document.querySelectorAll('#balanceTable tr:last-child input');
            const incomeInput = inputs[0].value ? parseFloat(inputs[0].value) : null;
            const expenseInput = inputs[1].value ? parseFloat(inputs[1].value) : null;
            const enteredBalance = parseFloat(inputs[2].value);
            const correctBalance = currentBalance + incomeInput - expenseInput;

            const isIncomeEvent = currentEventType === "income";
            const isExpenseEvent = currentEventType === "expense";

            console.log({
                currentEvent,
                currentAmount,
                incomeInput,
                expenseInput,
                enteredBalance,
                correctBalance,
                currentBalance,
                isIncomeEvent,
                isExpenseEvent
            });

            let feedbackMsg = "";

            if (isIncomeEvent && expenseInput > 0 || isExpenseEvent && incomeInput > 0) {
                feedbackMsg = "‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ß‡πà‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢";
            } else if (isIncomeEvent && incomeInput !== currentAmount) {
                feedbackMsg = "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
            } else if (isExpenseEvent && expenseInput !== currentAmount) {
                feedbackMsg = "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
            } else if (enteredBalance !== correctBalance) {
                feedbackMsg = "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
            } else {
                feedbackMsg = "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á üéâ";
                currentBalance = correctBalance;
                document.getElementById("drawCardBtn").disabled = false;
                document.getElementById("submitBtn").disabled = true;

                const lastRowCells = document.querySelectorAll('#balanceTable tr:last-child td');
                lastRowCells[1].textContent = incomeInput ? formatAmount(incomeInput) : '';
                lastRowCells[2].textContent = expenseInput ? formatAmount(expenseInput) : '';
                lastRowCells[3].textContent = formatAmount(correctBalance);
            }

            document.getElementById("feedback").textContent = feedbackMsg;
        }

    </script>
</body>

</html>